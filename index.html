<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>ржЬржорж┐ ржнрж╛ржЧ</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  
  <!-- Google Font: Kalpurush -->
  <link href="https://fonts.googleapis.com/css2?family=Kalpurush&display=swap" rel="stylesheet" />
  
  <!-- ржХрж╛рж╕рзНржЯржо CSS ржлрж╛ржЗрж▓ рж▓рж┐ржВржХ -->
  <link href="styles.css" rel="stylesheet" />
  
</head>
<body>
  <div class="container">
    <div class="text-center mb-4"><h2 class="fw-bold">ржЬржорж┐ ржнрж╛ржЧ</h2></div>

    <div class="input-card" id="inputCard">
      <form id="calcForm" novalidate>
        <div class="row g-4">
          <div class="col-md-4">
            <label>ржорж░рж╣рзБржо/ржорж░рж╣рзБржорж╛</label>
            <select id="deceasedGender" class="form-select" onchange="toggleSpouseLabel()">
              <option value="">-- ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи --</option>
              <option value="husband">ржорж░рж╣рзБржо (ржкрзБрж░рзБрж╖)</option>
              <option value="wife">ржорж░рж╣рзБржорж╛ (ржорж╣рж┐рж▓рж╛)</option>
            </select>
          </div>
          <div class="col-md-8">
            <label>ржирж╛ржо</label>
            <input type="text" id="deceasedName" class="form-control" placeholder="ржорзГржд ржмрзНржпржХрзНрждрж┐рж░ ржирж╛ржо рж▓рж┐ржЦрзБржи" />
          </div>

          <div class="col-md-6">
            <label>ржЬржорж┐рж░ ржкрж░рж┐ржорж╛ржг (рж╢рждржХ)</label>
            <input type="text" id="deceasedLand" class="form-control" placeholder="ржмрж╛ржВрж▓рж╛/ржЗржВрж░рзЗржЬрж┐ ржЗржиржкрзБржЯ" />
          </div>

          <div class="col-md-6">
            <label id="spouseLabel">рж╕рзНржмрж╛ржорзА/рж╕рзНрждрзНрж░рзАрж░ ржирж╛ржо</label>
            <input type="text" id="spouseInput" class="form-control" placeholder="ржирж╛ржо рж▓рж┐ржЦрзБржи (рж╕рзНрждрзНрж░рзА рж╣рж▓рзЗ ржХржорж╛ ржжрж┐рзЯрзЗ ржПржХрж╛ржзрж┐ржХ)" />
          </div>

          <div class="col-md-6 d-flex align-items-center">
            <input type="checkbox" id="spouseDeceased" />
            <label class="ms-2 mb-0" style="user-select:none;">рж╕рзНржмрж╛ржорзА/рж╕рзНрждрзНрж░рзА ржорзГржд</label>
          </div>

          <div class="col-md-6">
            <label>ржЫрзЗрж▓рзЗрж░ рж╕ржВржЦрзНржпрж╛</label>
            <input type="text" id="numSons" class="form-control" oninput="handleSonInput()" />
          </div>
          <div class="col-md-6">
            <label>ржорзЗрзЯрзЗрж░ рж╕ржВржЦрзНржпрж╛</label>
            <input type="text" id="numDaughters" class="form-control" oninput="handleDaughterInput()" />
          </div>

          <div class="col-12 text-center">
            <button type="button" class="btn btn-primary btn-lg" onclick="calculate()">ЁЯФШ рж╣рж┐рж╕рж╛ржм ржХрж░рзБржи</button>
          </div>
        </div>
      </form>
    </div>

    <div class="result-card" id="resultCard" style="display:none;">
      <div id="deceasedSummary"></div>
      <h4>ржлрж▓рж╛ржлрж▓</h4>
      <div id="resultTable"></div>
      <div id="deceasedShare"></div>
      <div class="text-center mt-3">
        <button class="btn btn-success" onclick="window.print()">ЁЯЦия╕П ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзБржи</button>
      </div>
    </div>

    <div class="example-card" id="exampleCard">
      <h5>рж╣рж┐рж╕рж╛ржмрзЗрж░ ржЙржжрж╛рж╣рж░ржг ржУ ржмрзНржпрж╛ржЦрзНржпрж╛</h5>
      <p>ржзрж░рзБржи, ржорж░рж╣рзБржо ржПржХржЬржи ржкрзБрж░рзБрж╖ ржпрж╛рж░ ржорзЛржЯ ржЬржорж┐ рззрзжрзж рж╢рждржХред рждрж╛рж░ рж╕рзНрждрзНрж░рзА ржПржмржВ рзи ржЫрзЗрж▓рзЗ, рзз ржорзЗрзЯрзЗ рж░рзЯрзЗржЫрзЗред</p>
      <ul>
        <li>рж╕рзНржмрж╛ржорзА ржерж╛ржХрж▓рзЗ рж╕рзНрждрзНрж░рзАржХрзЗ рзз/рзо ржнрж╛ржЧ (рззрзи.рзл рж╢рждржХ) ржжрзЗржУрзЯрж╛ рж╣рзЯред</li>
        <li>ржмрж╛ржХрж┐ ржЬржорж┐ ржЫрзЗрж▓рзЗ-ржорзЗрзЯрзЗржжрзЗрж░ ржоржзрзНржпрзЗ ржмржгрзНржЯрж┐ржд рж╣рзЯ, ржпрзЗржЦрж╛ржирзЗ ржЫрзЗрж▓рзЗ рзи ржЧрзБржг ржнрж╛ржЧ ржкрж╛рзЯ ржорзЗрзЯрзЗрж░ рждрзБрж▓ржирж╛рзЯред</li>
        <li>ржЕрж░рзНржерж╛рзО, рзорзн.рзл рж╢рждржХ ржнрж╛ржЧ рж╣рзЯ рзи ржЫрзЗрж▓рзЗ ржУ рзз ржорзЗрзЯрзЗ ржПрж░ ржоржзрзНржпрзЗред</li>
        <li>ржкрзНрж░рждрж┐ржЯрж┐ ржЫрзЗрж▓рзЗ ржкрж╛рзЯ (рзи/(2*2+1)) = рзи/рзл ржЕржВрж╢ ржПржмржВ ржорзЗрзЯрзЗ ржкрж╛рзЯ рзз/рзл ржЕржВрж╢ред</li>
        <li>рж╕рзБрждрж░рж╛ржВ, рзи ржЫрзЗрж▓рзЗ ржкрзНрж░рждрзНржпрзЗржХрзЗ ржкрж╛ржмрзЗ рзйрзл рж╢рждржХ ржПржмржВ рзз ржорзЗрзЯрзЗ ржкрж╛ржмрзЗ рззрзн.рзл рж╢рждржХ ржЬржорж┐ред</li>
      </ul>
      <p>ржЖржкржирж╛рж░ рждржерзНржп ржЕржирзБржпрж╛рзЯрзА рж╕ржарж┐ржХ рж╣рж┐рж╕рж╛ржм ржжрзЗржЦрж╛ржирзЛ рж╣ржмрзЗред</p>
    </div>
  </div>

  <footer>
    <p>┬й рзирзжрзирзл ржЬржорж┐ ржнрж╛ржЧ - <a href="#">ржмрзНржпржмрж╣рж╛рж░ ржирзАрждрж┐ржорж╛рж▓рж╛</a> | <a href="#">ржЧрзЛржкржирзАржпрж╝рждрж╛ ржирзАрждрж┐</a></p>
  </footer>

  <!-- рж╕рж╛ржЙржирзНржб ржлрж╛ржЗрж▓ -->
  <audio id="keySound" src="https://actions.google.com/sounds/v1/keyboard/keyboard_press_click.ogg" preload="auto"></audio>
  <audio id="focusSound" src="https://actions.google.com/sounds/v1/ui/click_on_keyboard.ogg" preload="auto"></audio>
  <audio id="clickSound" src="https://actions.google.com/sounds/v1/ui/click.ogg" preload="auto"></audio>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    function bnToEn(s) {
      const m = { "рзж":"0","рзз":"1","рзи":"2","рзй":"3","рзк":"4","рзл":"5","рзм":"6","рзн":"7","рзо":"8","рзп":"9" };
      return s.replace(/[рзж-рзп]/g, d=>m[d]);
    }
    function convertBn(n) {
      const m = { "0":"рзж","1":"рзз","2":"рзи","3":"рзй","4":"рзк","5":"рзл","6":"рзм","7":"рзн","8":"рзо","9":"рзп",".":"." };
      return n.toString().replace(/[0-9.]/g, d=>m[d]);
    }
    function toggleSpouseLabel() {
      const g = document.getElementById("deceasedGender").value;
      const lbl = document.getElementById("spouseLabel");
      if (g==="husband") lbl.textContent="рж╕рзНрждрзНрж░рзАржжрзЗрж░ ржирж╛ржо";
      else if (g==="wife") lbl.textContent="рж╕рзНржмрж╛ржорзАрж░ ржирж╛ржо";
      else lbl.textContent="рж╕рзНржмрж╛ржорзА/рж╕рзНрждрзНрж░рзАрж░ ржирж╛ржо";
    }
    function handleSonInput() {
      const v = +bnToEn(document.getElementById("numSons").value)||0;
      let h = ""; for (let i=1;i<=v;i++) h+=`<input type="text" class="form-control mb-1 son-name" placeholder="ржЫрзЗрж▓рзЗ ${i} ржПрж░ ржирж╛ржо" />`;
      document.getElementById("sonsDiv")?.remove(); 
      const div = document.createElement("div"); div.id="sonsDiv"; div.className="mt-2"; div.innerHTML=h;
      document.getElementById("numSons").parentElement.append(div);
    }
    function handleDaughterInput() {
      const v = +bnToEn(document.getElementById("numDaughters").value)||0;
      let h = ""; for (let i=1;i<=v;i++) h+=`<input type="text" class="form-control mb-1 daughter-name" placeholder="ржорзЗрзЯрзЗ ${i} ржПрж░ ржирж╛ржо" />`;
      document.getElementById("daughtersDiv")?.remove(); 
      const div = document.createElement("div"); div.id="daughtersDiv"; div.className="mt-2"; div.innerHTML=h;
      document.getElementById("numDaughters").parentElement.append(div);
    }

    function calculate() {
      const g = document.getElementById("deceasedGender").value;
      const name = document.getElementById("deceasedName").value.trim();
      const land = parseFloat(bnToEn(document.getElementById("deceasedLand").value));
      if (!g||!name||isNaN(land)||land<=0) { alert("рж╕ржм рждржерзНржп ржкрзВрж░ржг ржХрж░рзБржи"); return; }

      const spouseDeceased = document.getElementById("spouseDeceased").checked;
      const spousesRaw = document.getElementById("spouseInput").value.trim();
      const spouses = spousesRaw?spousesRaw.split(",").map(s=>s.trim()).filter(s=>s):[];

      const sonsCount = +(bnToEn(document.getElementById("numSons").value))||0;
      const daughtersCount = +(bnToEn(document.getElementById("numDaughters").value))||0;

      const sonNames = Array.from(document.getElementsByClassName("son-name")).map(i=>i.value.trim());
      const daughterNames = Array.from(document.getElementsByClassName("daughter-name")).map(i=>i.value.trim());
      if (sonNames.length!==sonsCount||daughterNames.length!==daughtersCount) { alert("рж╕ржирзНрждрж╛ржирзЗрж░ ржирж╛ржо ржкрзВрж░ржг ржХрж░рзБржи"); return; }

      const spouseRel = g==="husband"?"рж╕рзНрждрзНрж░рзА":"рж╕рзНржмрж╛ржорзА";
      const totalUnits = 1000;
      let unitsLeft = totalUnits;

      let shares = [];
      let spouseShare=0;
      if (!spouseDeceased && spouses.length>0) {
        spouseShare = ((sonsCount+daughtersCount)>0)
          ? (spouseRel==="рж╕рзНрждрзНрж░рзА"?totalUnits/8:totalUnits/4)
          : (spouseRel==="рж╕рзНрждрзНрж░рзА"?totalUnits/4:totalUnits/2);
        const each = spouseShare/spouses.length;
        spouses.forEach(s=>shares.push({person:s,relation:spouseRel,val:each}));
      }
      unitsLeft -= spouseShare;

      if (sonsCount+daughtersCount>0) {
        const parts = sonsCount*2 + daughtersCount;
        const per = unitsLeft/parts;
        sonNames.forEach(n=>shares.push({person:n,relation:"ржЫрзЗрж▓рзЗ",val:per*2}));
        daughterNames.forEach(n=>shares.push({person:n,relation:"ржорзЗрзЯрзЗ",val:per}));
      }

      const groups = {
        spouse: shares.filter(s=>s.relation===spouseRel),
        sons: shares.filter(s=>s.relation==="ржЫрзЗрж▓рзЗ"),
        daughters: shares.filter(s=>s.relation==="ржорзЗрзЯрзЗ")
      };
      function renderGroup(arr, title, cls){
        let html="";
        arr.forEach(sh=>{
          const v=(land*sh.val)/totalUnits;
          html+=`<tr><td>${sh.person}</td><td>${sh.relation}</td><td>${convertBn(v.toFixed(3))}</td></tr>`;
        });
        if (arr.length){
          const sum = arr.reduce((a,b)=>a+b.val,0);
          const v = (land*sum)/totalUnits;
          html+=`<tr class="summary-row ${cls}"><td colspan="2">ржорзЛржЯ ${title} ржЬржорж┐</td><td>${convertBn(v.toFixed(3))}</td></tr>`;
        }
        return html;
      }

      let tbl=`<table><thead><tr><th>ржирж╛ржо</th><th>рж╕ржорзНржкрж░рзНржХ</th><th>ржЬржорж┐рж░ ржкрж░рж┐ржорж╛ржг</th></tr></thead><tbody>`;
      tbl+=renderGroup(groups.spouse, spouseRel==="рж╕рзНрждрзНрж░рзА"?"рж╕рзНрждрзНрж░рзАржжрзЗрж░":"рж╕рзНржмрж╛ржорзАрж░", "spouse");
      tbl+=renderGroup(groups.sons, "ржЫрзЗрж▓рзЗржжрзЗрж░", "sons");
      tbl+=renderGroup(groups.daughters, "ржорзЗрзЯрзЗржжрзЗрж░", "daughters");
      tbl+="</tbody></table>";

      document.getElementById("deceasedSummary").innerHTML=`<b>${name}</b> (${g==="husband"?"ржорж░рж╣рзБржо":"ржорж░рж╣рзБржорж╛"}) - ржорзЛржЯ ржЬржорж┐ ${convertBn(land)} рж╢рждржХ`;
      document.getElementById("resultTable").innerHTML = tbl;
      document.getElementById("deceasedShare").textContent = "";

      document.getElementById("inputCard").style.display="none";
      document.getElementById("resultCard").style.display="block";
      window.scrollTo({top:0, behavior:"smooth"});
    }

    // --- Sound control section ---
    const keySound = document.getElementById('keySound');
    const focusSound = document.getElementById('focusSound');
    const clickSound = document.getElementById('clickSound');

    let isInputFocused = false;

    document.addEventListener('keydown', () => {
      if(isInputFocused){
        keySound.currentTime = 0;
        keySound.play().catch(()=>{});
      }
    });

    const inputsAndSelects = document.querySelectorAll('input, select, textarea');
    inputsAndSelects.forEach(el => {
      el.addEventListener('focus', () => {
        isInputFocused = true;
        focusSound.currentTime = 0;
        focusSound.play().catch(()=>{});
      });
      el.addEventListener('blur', () => {
        isInputFocused = false;
      });
    });

    document.getElementById('deceasedGender').addEventListener('change', () => {
      clickSound.currentTime = 0;
      clickSound.play().catch(()=>{});
    });

    document.querySelectorAll('button, .btn').forEach(btn => {
      btn.addEventListener('click', () => {
        clickSound.currentTime = 0;
        clickSound.play().catch(()=>{});
      });
    });
  </script>
</body>
</html>
